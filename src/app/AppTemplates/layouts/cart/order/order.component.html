<div class="order-page-wrapper">
    <div class="cart-breadcrumbs">
        <a (click)="backToCart.emit()">Список товаров </a><svg xmlns="http://www.w3.org/2000/svg" width="8" height="14" viewBox="0 0 8 14" fill="none">
            <path d="M1 1L7 7L0.999999 13" stroke="#B8B6B6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg><span>Доставка</span>
    </div>
    
    <div class="order-form-wrapper">
        <div class="form-group">
            <form [formGroup]="phoneForm">
                <label class="enter-phone">
                    <span class="enter-phone_lable">
                        Номер телефона
                    </span>
                    <input 
                    class="userDataInput"
                    type="tel" 
                    [textMask]="{mask: mask, showMask: false, placeholderChar: '_'}"
                    inputmode="numeric"
                    formControlName="value"
                    placeholder="Укажите номер телефона..."
                    (blur)="checkConfirmUserPhone()">
                </label>
            </form>
            <form [formGroup]="nameForm">
                <label class="enter-name">
                    <span class="enter-name_lable">
                        Имя
                    </span>
                    <input 
                    class="userDataInput"
                    type="text" 
                    formControlName="value"
                    (blur)="changeName()"
                    placeholder="Укажите имя...">
                </label>
            </form>
        </div>
        <!-- onsubmit="ym(87591412,'reachGoal','zakaz'); return true;" -->
        <form [formGroup]="form">
            <div class="form-group">
                <h2 class="form-title">
                    Доставка
                </h2>
                <label class="delivery-address">
                    <span class="if_tablet_hide"> Укажите улицу, дом, квартиру </span>
                    <span class="city-place">
                        <svg xmlns="http://www.w3.org/2000/svg" width="8" height="11" viewBox="0 0 8 11" fill="none">
                            <path d="M4.33269 0C2.31092 0 0.666016 1.64491 0.666016 3.66667C0.666016 4.27361 0.81776 4.87538 1.10623 5.40914L4.13218 10.8818C4.17246 10.9548 4.24922 11 4.33269 11C4.41616 11 4.49292 10.9548 4.5332 10.8818L7.56027 5.40734C7.84762 4.87538 7.99936 4.27359 7.99936 3.66665C7.99936 1.64491 6.35445 0 4.33269 0ZM4.33269 5.5C3.32181 5.5 2.49936 4.67756 2.49936 3.66667C2.49936 2.65579 3.32181 1.83335 4.33269 1.83335C5.34357 1.83335 6.16602 2.65579 6.16602 3.66667C6.16602 4.67756 5.34357 5.5 4.33269 5.5Z" fill="#FF7308"/>
                        </svg> {{currentDeliveredCityName}}
                        <span class="question_mark_icon" style="width: 20px;">
                            <span ><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none" >
                                <path d="M9 17.5938C4.26135 17.5938 0.40625 13.7386 0.40625 9C0.40625 4.26135 4.26135 0.40625 9 0.40625C13.7386 0.40625 17.5938 4.26135 17.5938 9C17.5938 13.7386 13.7386 17.5938 9 17.5938ZM9 1.69531C4.97218 1.69531 1.69531 4.97218 1.69531 9C1.69531 13.0278 4.97218 16.3047 9 16.3047C13.0278 16.3047 16.3047 13.0278 16.3047 9C16.3047 4.97218 13.0278 1.69531 9 1.69531Z" fill="#8290A7"></path>
                                <path d="M8.99956 11.7495C8.64355 11.7495 8.35503 11.461 8.35503 11.105V9.42099C8.35503 9.06499 8.64355 8.77646 8.99956 8.77646C9.75856 8.77646 10.3761 8.15895 10.3761 7.39995C10.3761 6.64095 9.75856 6.02344 8.99956 6.02344C8.24055 6.02344 7.62305 6.64095 7.62305 7.39995C7.62305 7.75595 7.33452 8.04448 6.97852 8.04448C6.62268 8.04448 6.33398 7.75595 6.33398 7.39995C6.33398 5.93011 7.52972 4.73438 8.99956 4.73438C10.4694 4.73438 11.6651 5.93011 11.6651 7.39995C11.6651 8.64755 10.8034 9.6976 9.64409 9.98663V11.105C9.64409 11.461 9.35556 11.7495 8.99956 11.7495Z" fill="#8290A7"></path>
                                <path d="M9.8414 13.1253C9.8414 13.5904 9.46442 13.9674 8.99931 13.9674C8.53421 13.9674 8.15723 13.5904 8.15723 13.1253C8.15723 12.6602 8.53421 12.2832 8.99931 12.2832C9.46442 12.2832 9.8414 12.6602 9.8414 13.1253Z" fill="#8290A7"></path>
                                </svg>
                            </span>
                            <span class="delivery_city">
                                Регион можно изменить в профиле пользователя
                            </span>
                        </span>
                    </span>
                    
                    <input 
                    type="text" 
                    formControlName="address"
                    class="addres-input"
                    (keyup)="serchAddresValues()"
                    (blur)="setAddresToProfile()">
                    <div *ngIf="scrOut && scrOut?.length > 0" class="serch-outs">
                        <span *ngFor="let item of scrOut" (click)="setAddresByItem(item)">
                            {{item}}
                        </span>
                    </div>
                </label>
            </div>
            <div class="form-group delivery_time">
                <h2 class="form-title">
                    Желаемая дата доставки <span class="tooltip-wrap if_tablet_hide"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                        <path d="M9 17.5938C4.26135 17.5938 0.40625 13.7386 0.40625 9C0.40625 4.26135 4.26135 0.40625 9 0.40625C13.7386 0.40625 17.5938 4.26135 17.5938 9C17.5938 13.7386 13.7386 17.5938 9 17.5938ZM9 1.69531C4.97218 1.69531 1.69531 4.97218 1.69531 9C1.69531 13.0278 4.97218 16.3047 9 16.3047C13.0278 16.3047 16.3047 13.0278 16.3047 9C16.3047 4.97218 13.0278 1.69531 9 1.69531Z" fill="#8290A7"></path>
                        <path d="M8.99956 11.7495C8.64355 11.7495 8.35503 11.461 8.35503 11.105V9.42099C8.35503 9.06499 8.64355 8.77646 8.99956 8.77646C9.75856 8.77646 10.3761 8.15895 10.3761 7.39995C10.3761 6.64095 9.75856 6.02344 8.99956 6.02344C8.24055 6.02344 7.62305 6.64095 7.62305 7.39995C7.62305 7.75595 7.33452 8.04448 6.97852 8.04448C6.62268 8.04448 6.33398 7.75595 6.33398 7.39995C6.33398 5.93011 7.52972 4.73438 8.99956 4.73438C10.4694 4.73438 11.6651 5.93011 11.6651 7.39995C11.6651 8.64755 10.8034 9.6976 9.64409 9.98663V11.105C9.64409 11.461 9.35556 11.7495 8.99956 11.7495Z" fill="#8290A7"></path>
                        <path d="M9.8414 13.1253C9.8414 13.5904 9.46442 13.9674 8.99931 13.9674C8.53421 13.9674 8.15723 13.5904 8.15723 13.1253C8.15723 12.6602 8.53421 12.2832 8.99931 12.2832C9.46442 12.2832 9.8414 12.6602 9.8414 13.1253Z" fill="#8290A7"></path>
                        </svg><span class="tooltip-body">
                        Осуществляем доставку с <b>9:00 до 22:00, с ПН по ВС</b> <br /><br />
                        Оформление заказа после 21:00 возможно только с доставкой на следующий день.
                    </span></span>
                </h2>
                <div class="form-group-row">
                    <div class="delivery_day">
                        <label class="input_label" for="date">Дата</label>
                        <div class="form-group_data_picker data_picker">
                            <input *ngIf="today" type="text" class="form-control"
                                id="date"
                                [minDate]="today"
                                [maxDate]="maxDay"
                                #dp="bsDatepicker"
                                formControlName="delivery_date"
                                [bsConfig]="{ dateInputFormat: 'DD.MM.YYYY', adaptivePosition: false, showWeekNumbers:false,containerClass:'order-datapiker theme-green my-class'}"
                                bsDatepicker
                                (bsValueChange)="changeDate($event)"
                                >
                            <span class="btn-calendar"><i class="fa fa-calendar fa-2x"></i></span>
                        </div>
                    </div>
                    <div *ngIf="timePeriods && timePeriods.length > 0" class="form-group_time_delivey delivery_timing" id="time">
                        <label class="input_label" for="time">Время доставки</label>
                        <ng-select  
                            [items]="timePeriods"
                            bindValue="id"
                            labelForId="time"
                            bindLabel="name"
                            inputmode="none"
                            [searchable]="false"
                            formControlName="delivery_time_period">
                        </ng-select>
                        <span class="tooltip-body if_tablet_show"> Осуществляем доставку с <b>9:00 до 22:00, с ПН по ВС</b><br><br> Оформление заказа после 21:00 возможно только с доставкой на следующий день. </span>
                    </div>
                </div>
            </div>
            <div class="form-group delivery_comment">
                <h2 class="form-title">
                    Комментарии к доставке
                </h2>
                <label>
                    <span class="delivery_comment__label">
                        Ваш комментарий:
                    </span>
                    <textarea formControlName="comment"></textarea>
                </label>
            </div>
            <button (click)="submit()" class="btn red b_p cart_next my-5 if_tablet_hide" type="submit">Подтвердить заказ</button>
        </form>
    </div>
    
    <div class="order-detalis-short">
        <div>
            <p>
                Товаров: <span>{{beforeOrderParams.productCount}}</span>
            </p>
            <hr>
            <p>
                Сумма заказов: <span>{{beforeOrderParams.totalPrice}} ₽</span>
            </p>
        </div>
    </div>

    <button class="btn red b_p cart_next my-5 if_tablet_show" type="submit" (click)="submit()">Оформить заказ</button>

    <div class="edit-profile_data__block" *ngIf="showConfirm">
        <div class="confirm-edited">
            <span class="close" (click)="closeConfirm()">
                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12" fill="none">
                    <path d="M1 1L10.9987 10.9987" stroke="#8290A7" stroke-linecap="round"/>
                    <path d="M10.999 1L1.00031 10.9987" stroke="#8290A7" stroke-linecap="round"/>
                </svg>
            </span>
            <h2 class="confirm-title">
                    Подтверждение телефона
            </h2>
            <p>
                Код был отправлен на <span>телефон </span>{{ phoneForm.value.value }}
            </p>
            <p>
                Введите код 
            </p>

            <input
                appSmsField class="field" type="text" pattern="[0-9]"
                (paste)="onPaste($event)"
                [textMask]="{mask: codeMask}" inputmode="numeric" [disabled]="disableds[0]"
                [value]="values[0]" (keyup)="changeValues($event, 0)" >
            <input
                appSmsField class="field" type="text" pattern="[0-9]"
                [textMask]="{mask: codeMask}" inputmode="numeric" [disabled]="disableds[1]"
                [value]="values[1]" (keyup)="changeValues($event, 1)" >
            <input
                appSmsField class="field" type="text" pattern="[0-9]"
                [textMask]="{mask: codeMask}" inputmode="numeric" [disabled]="disableds[2]"
                [value]="values[2]" (keyup)="changeValues($event, 2)" >
            <input
                appSmsField class="field" type="text" pattern="[0-9]"
                [textMask]="{mask: codeMask}" inputmode="numeric" [disabled]="disableds[3]"
                [value]="values[3]" (keyup)="changeValues($event, 3)" >
            <span class="resend" *ngIf="subscribeTimer !=0; else ResetTimer">
                Повторная отправка через - {{subscribeTimer}}
            </span>

            <ng-template #ResetTimer>
                <button type="button" class="resend-button" (click)="checkConfirmUserPhone(); subscribeTimer = 60; timer(60)">Отправить повторно</button>
            </ng-template>

        </div>
    </div>

</div>
